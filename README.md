# ObjaTHOR

Objaverse asset annotator and importer for use in THOR. 

## Installation

```bash
pip install objathor[annotation,blender]
```

Here the following extras are installed: `annotation` to use openai to generate annotations and `blender` installed as a module.


From source:

```bash
pip install -e ".[annotation,blender]"
```

We recommend setting an environment variable with your OpenAI key:

```bash
export OPENAI_API_KEY=[Your key]
```

If we're planning to annotate objects for which we don't have pre-generated
views in S3 (see an example under [Annotation](#annotation) below), we also need to install blender either as an extra (as shown above) or as an application:

[Blender install instructions](https://docs.blender.org/manual/en/latest/getting_started/installing/index.html)

## Usage

### Annotation

You must install the `annotation` extra requirement through pip.

To generate the initial annotation for a uid in Objaverse for which we have pre-rendered views in S3, like

[https://objaverse-im.s3.us-west-2.amazonaws.com/0070ac4bf50b496387365843d4bf5432/009.png](https://objaverse-im.s3.us-west-2.amazonaws.com/0070ac4bf50b496387365843d4bf5432/009.png),

we can just:

```bash
OUTPUT_DIR=/path/to/output
python -m objathor.main \
--uid 0070ac4bf50b496387365843d4bf5432 \
--output "$OUTPUT_DIR"/0070ac4bf50b496387365843d4bf5432.json.gz
```

If we don't have pre-rendered views, we can just add `--local_render`:

```bash
OUTPUT_DIR=/path/to/output
python -m objathor.main \
--uid 0070ac4bf50b496387365843d4bf5432 \
--output "$OUTPUT_DIR"/0070ac4bf50b496387365843d4bf5432.json.gz \
--local_render
```

### GLB to THOR asset conversion

From the repository root run:

```
python 
-m objathor.asset_conversion.pipeline_to_thor 
--object_ids=000074a334c541878360457c672b6c2e 
--output_dir=<some_absolute_path>
--extension=.msgpack.gz
 --annotations=<annotations_file_path> 
--live 
--blender_as_module
```

Where `object_ids` is a string of comma separated list of `Objaverse` object ids to process.
`output_dir` is an absolute path indicating where to write the output of the conversion.
`annotations` is optional, and is the path to an annotations file as generated by the process described above.

Run `python -m objathor.asset_conversion.pipeline_to_thor --help` for other options.
